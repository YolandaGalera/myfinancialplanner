"use strict";angular.module("yoprojectAngularApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMessages","ui.bootstrap","datePicker"]).factory("securityInterceptor",["$q","$rootScope",function(a,b){}]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/contact",{templateUrl:"views/contact.html"}).when("/about",{templateUrl:"views/about.html"}).when("/faq",{templateUrl:"views/faq.html"}).when("/legal",{templateUrl:"views/legal.html"}).when("/reset-password-request",{templateUrl:"views/resetPasswordRequest.html",controller:"ResetPasswordCtrl"}).when("/reset-by-token",{templateUrl:"views/resetPassword.html",controller:"ResetPasswordCtrl"}).when("/",{templateUrl:"views/expectedSituation.html",controller:"ExpectedSituationCtrl",requiresLogin:!0}).when("/yearlyOverview",{templateUrl:"views/yearlyOverview.html",controller:"YearlyOverviewCtrl",requiresLogin:!0}).when("/balanceDetail",{templateUrl:"views/balanceDetail.html",controller:"BalanceDetailCtrl",requiresLogin:!0}).when("/dailySituation",{templateUrl:"views/realDailySituation.html",controller:"RealDailySituationCtrl",requiresLogin:!0}).when("/instantEntry",{templateUrl:"views/instantEntry.html",controller:"InstantEntryCtrl",requiresLogin:!0}).when("/account",{templateUrl:"views/user.html",controller:"UserCtrl",requiresLogin:!0}).otherwise({redirectTo:"/"})}]).directive("leftPanel",function(){return{restrict:"E",templateUrl:"../views/leftPanel.html",controller:"LeftPanelCtrl"}}).directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){function e(){var a=b.html();c.stripBr&&_.contains(a,"<br>")&&(a=a.replace(/<br>/g,"")),c.stripBr&&_.contains(a,"&nbsp;")&&(a=a.replace(/&nbsp;/g,"")),c.stripBr&&_.contains(a,"nbsp;")&&(a=a.replace(/nbsp;/g,"")),c.stripBr&&_.contains(a,"amp;")&&(a=a.replace(/amp;/g,"")),c.stripBr&&_.contains(a,"&amp;")&&(a=a.replace(/&amp;/g,"")),d.$setViewValue(a)}d&&(d.$render=function(){b.html(d.$viewValue||"")},b.on("keypress",function(a){13==a.keyCode&&(a.preventDefault(),a.stopPropagation(),b.blur())}),b.on("blur keyup change",function(){a.$apply(e)}))}}}).directive("convertToNumber",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return parseInt(a,10)}),d.$formatters.push(function(a){return""+a})}}}),angular.module("yoprojectAngularApp").controller("ResetPasswordCtrl",["$scope","$location","$timeout","$routeParams","userService","loginService",function(a,b,c,d,e,f){function g(){e.resetForgottenPasswordRequest(a.email).then(function(){a.isEmailSent=!0},function(){a.isEmailFalse=!0})}function h(){var b=j(),d=k();e.resetForgottenPassword(d,a.password,b).then(function(){a.isEmailSent=!0,a.isPasswordChanged=!0,c(i,5e3)},function(){a.isEmailFalse=!0,a.isPasswordChanged=!1})}function i(){b.path("/login")}function j(){return d.token}function k(){return d.email}a.isEmailSent=!1,a.arePasswordsEquals=!0,a.passwordsEqualsMessage=null,a.isEmailFalse=!1,a.isPasswordChanged=!1,f.loginStatus.isLogged=!1,a.resetForgottenPasswordRequest=function(b){if(b){if(a.isEmailSent=!1,a.isEmailFalse=!1,a.arePasswordsEquals=a.password===a.repeatedPassword,!a.arePasswordsEquals)return void(a.passwordsEqualsMessage="Passwords must be equals.");a.passwordsEqualsMessage=null,g()}},a.resetForgottenPassword=function(b){if(a.isEmailSent=!1,a.isEmailFalse=!1,b){if(a.arePasswordsEquals=a.password===a.repeatedPassword,!a.arePasswordsEquals)return void(a.passwordsEqualsMessage="Passwords must be equals.");a.passwordsEqualsMessage=null,h()}}}]),angular.module("yoprojectAngularApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("yoprojectAngularApp").controller("AppContainerCtrl",["$rootScope","$route","$scope","$location","$window","loginService","userService","calculatorSaveDataService",function(a,b,c,d,e,f,g,h){function i(){c.initUser()}a.route=b,c.loginStatus=f.loginStatus,c.user=g.getUser(),c.title="Calculator",c.styleAppContainer=null;var j=angular.element(e);c.getWindowDimensions=function(){return{h:j.height(),w:j.width()}},j.bind("resize",function(){c.$apply()}),c.initUser=function(){g.loadUserIfNeeded().then(function(a){f.setIsLogged(!0),_.isUndefined(a)||h.loadExpectedSituation()})},c.goAccountSettings=function(){d.path("/account")},c.$watch(c.getWindowDimensions,function(a){var b=50;c.loginStatus.isLogged&&(c.styleAppContainer=Math.floor((a.h-b)/a.h*100)-1+"%")},!0),c.$watch(function(){return c.loginStatus.isLogged},function(a){var b=50;if(a){var d=c.getWindowDimensions();return void(c.styleAppContainer=Math.floor((d.h-b)/d.h*100)-1+"%")}c.styleAppContainer="100%"},!0),i()}]),angular.module("yoprojectAngularApp").controller("BalanceDetailCtrl",["$scope","$filter","calculatorSaveDataService","yearlyOverviewService",function(a,b,c,d){function e(){a.nameGroup="",a.typeGroup="",a.selectedPeriod=""}function f(){a.left&&(a.left.fromDate="",a.left.toDate=""),a.incomeFilter="",a.expenseFilter="",a.selectedTypeCategory="",a.fromValue=""}function g(){null!=a.selectedTypeCategory&&(a.balance=b("filter")(a.balance,a.selectedTypeCategory.name))}function h(){var c=[],d=[];a.incomeFilter&&(c=b("filter")(a.balance,"income")),a.expenseFilter&&(d=b("filter")(a.balance,"expense")),(a.incomeFilter||a.expenseFilter)&&(a.balance=c.concat(d))}function i(){if(null!=a.fromValue||null!=a.toValue){var b=null!=a.fromValue?a.fromValue:Number.MIN_VALUE,c=null!=a.toValue?a.toValue:Number.MAX_VALUE;a.balance=a.balance.filter(function(a){return a.value>=b&&a.value<=c})}}function j(){(null!=a.dateFilter.fromDate||null!=a.dateFilter.toDate)&&(a.balance=a.balance.filter(function(b){return null===a.dateFilter.fromDate&&null!=a.dateFilter.toDate?b.date.setHours(0,0,0,0)<=a.dateFilter.toDate.setHours(0,0,0,0):null!=a.dateFilter.fromDate&&null===a.dateFilter.toDate?b.date.setHours(0,0,0,0)>=a.dateFilter.fromDate.setHours(0,0,0,0):null!=a.dateFilter.fromDate&&null!=a.dateFilter.toDate?b.date.setHours(0,0,0,0)>=a.dateFilter.fromDate.setHours(0,0,0,0)&&b.date.setHours(0,0,0,0)<=a.dateFilter.toDate.setHours(0,0,0,0):void 0}))}function k(){a.balance=b("orderBy")(a.balance,a.predicate,a.reverse),a.filteredBalance=a.balance.slice(a.begin,a.end),a.currentPage=1}function l(){var a=52,b=59,c=64,d=50,e=window.innerHeight-a-b-c-d,f=50;return Math.max(5,Math.ceil(e/f)-1)}function m(){a.numPerPage=l(),a.filteredBalance=[],a.currentPage=1,a.maxSize=Math.ceil(a.balance.length/a.numPerPage),a.$watch("currentPage + numPerPage",function(){a.begin=(a.currentPage-1)*a.numPerPage,a.end=a.begin+a.numPerPage,a.filteredBalance=a.balance.slice(a.begin,a.end)})}function n(a){return _.cloneDeep(_.flatten(Object.keys(a).map(function(b){return a[b]})))}function o(){a.balance=n(x),k()}function p(a,b,c){return a.income||a.expenses||(a.income=[],a.expenses=[]),_.includes(c,b.name)?void a.income.push(b):void a.expenses.push(b)}function q(a){var b=_.pluck(a.incomes,"name");a.incomes.forEach(function(a){p(x,a,b)}),a.expenses.forEach(function(a){p(x,a,b)}),o(),m()}function r(a){return _.reduce(a,function(a,b){var c=_.find(a,{name:b.name,date:b.date.setHours(0,0,0,0)});return _.isUndefined(c)?(b.date=b.date.setHours(0,0,0,0),a.push(b),a):(c.value+=b.value,a)},[])}function s(a,b){return _.reduce(a,function(a,c){var d={name:c.name};d[b]=c[b];var e=_.find(a,d);return _.isUndefined(e)?(a.push(c),a):(e.value+=c.value,a)},[])}function t(b){switch(a.selectedPeriod.name){case"daily":a.balance=r(b);break;case"weekly":a.balance=s(b,"week");break;case"yearly":a.balance=s(b,"year");break;default:a.balance=s(b,"month")}k()}function u(b){switch(a.selectedPeriod.name){case"daily":a.balance=w(b);break;case"weekly":a.balance=v(b,"week");break;case"yearly":a.balance=v(b,"year");break;default:a.balance=v(b,"month")}k()}function v(a,b){return _.reduce(a,function(a,c){var d={type:c.type};d[b]=c[b];var e=_.find(a,d);return _.isUndefined(e)&&"income"==c.type?(c.name="Income",a.push(c),a):_.isUndefined(e)&&"expense"==c.type?(c.name="Expense",a.push(c),a):(e.value+=c.value,a)},[])}function w(a){return _.reduce(a,function(a,b){var c=_.find(a,{type:b.type,date:b.date.setHours(0,0,0,0)});return _.isUndefined(c)&&"income"==b.type?(b.date=b.date.setHours(0,0,0,0),b.name="Income",a.push(b),a):_.isUndefined(c)&&"expense"==b.type?(b.date=b.date.setHours(0,0,0,0),b.name="Expense",a.push(b),a):(c.value+=b.value,a)},[])}var x={};a.predicate="date",a.reverse=!0,a.expectedExpenses=c.getExpectedExpenses(),a.expectedIncome=c.getExpectedIncome(),a.typeCategories=a.expectedExpenses.concat(a.expectedIncome),a.selectedTypeCategory={name:""},a.incomeFilter=!1,a.expenseFilter=!1,a.fromValue=null,a.toValue=null,a.dateFilter={fromDate:null,toDate:null},a.periods=[{name:"daily"},{name:"weekly"},{name:"monthly"},{name:"yearly"}],a.selectedPeriod={name:""},a.isShowFilter=!0,a.isShowGroupBy=!1,d.getYearlyBalance().then(q),a.groupByManager=function(){return a.nameGroup||a.typeGroup?(a.nameGroup&&(""==a.selectedPeriod.name&&(a.selectedPeriod=a.periods[2]),a.balance=n(x),t(a.balance)),void(a.typeGroup&&(""==a.selectedPeriod.name&&(a.selectedPeriod=a.periods[2]),a.balance=n(x),u(a.balance)))):(a.selectedPeriod={name:""},void a.filterManager())},a.toggleOrder=function(b){a.reverse=a.predicate===b?!a.reverse:!1,a.predicate=b,k()},a.filterManager=function(){a.balance=n(x),g(),h(),i(),j(),k()},a.toggleFilter=function(){a.isShowFilter=!a.isShowFilter,a.isShowGroupBy=!1,e(),a.groupByManager()},a.toggleGroupBy=function(){a.isShowGroupBy=!a.isShowGroupBy,a.isShowFilter=!1,f(),a.groupByManager()},a.$watchCollection("expectedIncome",function(b){a.typeCategories=b.concat(a.expectedExpenses)}),a.$watchCollection("expectedExpenses",function(b){a.typeCategories=b.concat(a.expectedIncome)}),a.$watch("currentPage",function(b){b>a.maxSize&&a.currentPage--}),a.$watch("nameGroup",function(b){1==b&&(a.typeGroup=!1)}),a.$watch("typeGroup",function(b){1==b&&(a.nameGroup=!1)})}]),angular.module("yoprojectAngularApp").controller("BalanceEntryDirectiveCtrl",["$rootScope","$scope","$modal","calculatorSaveDataService","yearlyOverviewService",function(a,b,c,d,e){function f(){d.isExpense(b.name)?b.categories=d.getExpectedExpenses():b.categories=d.getExpectedIncome()}function g(){b.edit||(b.disabled=!0)}function h(){b.disabled&&(b.disabled=!1)}b.disabled=!1,b.edit=!1,b.selectedCategory={name:b.name},b.selection={date:b.date},b.newValue=b.value,b.expectedExpenses=d.getExpectedExpenses(),b.expectedIncomes=d.getExpectedIncome(),b.modalInstance=void 0,"weekly"==b.format&&(b.isWeek=!0,b.weekOfYear=e.getWeek(b.date)),b.getFormat=function(){return"monthly"==b.format||""==b.format?(b.isWeek=!1,"yyyy-MM"):"yearly"==b.format?(b.isWeek=!1,"yyyy"):"daily"==b.format?(b.isWeek=!1,"yyyy-MM-dd"):void 0},b.createEditableFields=function(c){b.disabled||(b.edit=!0,a.$broadcast("CREATE_EDITABLE_FIELDS_CLICKED")),b.selectedCategory={name:b.name},b.selection={date:b.date},b.newValue=b.value},b.cancelEdition=function(c){b.edit&&(a.$broadcast("CANCEL_EDITABLE_FIELDS"),b.edit=!1,c.stopPropagation())},b.deleteEntry=function(){b.open("sm")},b.open=function(a){b.modalInstance=c.open({scope:b,animation:!0,templateUrl:"../views/deleteEntryConfirmation.html",size:a})},b.deleteItem=function(a){d.isExpense(b.name)?(e.deleteExpenses(b.id),b.cancelEdition(a)):(e.deleteIncomes(b.id),b.cancelEdition(a)),b.removeThisElement(),b.modalInstance.close()},b.cancel=function(){b.modalInstance.dismiss("cancel")},b.saveEdition=function(a){if(d.isExpense(b.name)){var c={ExpenseId:b.id,Name:b.selectedCategory.name,Value:b.newValue,ExpectedExpense:{ExpectedExpenseId:d.getExpectedExpenseId(b.selectedCategory.name)},Date:b.selection.date};e.updateExpenses(b.id,c)}else{var f={IncomeId:b.id,Name:b.selectedCategory.name,Value:b.newValue,ExpectedIncome:{ExpectedIncomeId:d.getExpectedIncomeId(b.selectedCategory.name)},Date:b.selection.date};e.updateIncomes(b.id,f)}b.cancelEdition(a),b.date=b.selection.date,b.name=b.selectedCategory.name,b.value=b.newValue},b.$on("CREATE_EDITABLE_FIELDS_CLICKED",g),b.$on("CANCEL_EDITABLE_FIELDS",h),b.$watchCollection("expectedExpenses",function(){f()}),b.$watchCollection("expectedIncomes",function(){f()}),f()}]),angular.module("yoprojectAngularApp").controller("ExpectedEntryDirectiveCtrl",["$rootScope","$scope","$modal","calculatorSaveDataService",function(a,b,c,d){function e(){var a={expectedExpenseId:b.id,name:b.newValue.name,value:b.newValue.quantity,deleted:!1};d.updateExpectedExpenses(b.id,a)}function f(){var a={expectedIncomeId:b.id,name:b.newValue.name,value:b.newValue.quantity,deleted:!1};d.updateExpectedIncomes(b.id,a)}function g(){"expense"===b.type?e():f()}function h(){var a={name:b.newValue.name,value:b.newValue.quantity,deleted:!1};"income"===b.type?d.saveExpectedIncome(a):d.saveExpectedExpense(a)}function i(){console.log("saveEdition RESTORE"),b.name=b.newValue.name,b.value=b.newValue.quantity,b.edit=!1,a.$broadcast("CANCEL_EDITABLE_FIELDS"),k()}function j(a,b,c){var d=_.filter(a,"deleted",!1);return _.any(d,"name",c)&&_.find(d,"name",c).id!=b}function k(){return d.isExpense(b.newValue.name)?void(b.categories=d.getExpectedExpenses()):void(b.categories=d.getExpectedIncome())}function l(){(!b.edit||b.isNewEntry())&&(b.disabled=!0)}function m(){b.disabled&&(b.disabled=!1)}b.disabled=!1,b.edit=!1,b.newValue={quantity:b.value,name:b.name},b.showDuplicatedNamesError=!1,b.expectedExpenses=d.getExpectedExpenses(),b.expectedIncomes=d.getExpectedIncome(),b.modalInstance=void 0,b.isNewEntry=function(){return 0===b.id},b.createEditableFields=function(){b.disabled||0==b.id||(b.edit=!0,a.$broadcast("CREATE_EDITABLE_FIELDS_CLICKED"))},b.cancelEdition=function(c){0===b.id&&a.$broadcast("CANCEL_CREATE_EDITABLE_FIELD"),a.$broadcast("CANCEL_EDITABLE_FIELDS"),b.showDuplicatedNamesError=!1,b.newValue={quantity:b.value,name:b.name},b.edit=!1,k(),c.stopPropagation()},b.deleteEntry=function(){b.open("sm")},b.open=function(a){b.modalInstance=c.open({scope:b,animation:!0,templateUrl:"../views/deleteEntryConfirmation.html",size:a})},b.deleteItem=function(a){if(d.isExpense(b.name)){var c={expectedExpenseId:b.id,name:b.name,value:b.newValue.quantity,deleted:!0};d.deleteExpectedExpenses(c)}else{var c={expectedIncomeId:b.id,name:b.name,value:b.newValue.quantity,deleted:!0};d.deleteExpectedIncomes(c)}b.cancelEdition(a),b.modalInstance.close()},b.cancel=function(){b.modalInstance.dismiss("cancel")},b.saveEdition=function(a,c){return console.log("saveEdition"),a?j(d.getExpectedIncome().concat(d.getExpectedExpenses()),b.id,b.newValue.name)?(b.showDuplicatedNamesError=!0,void console.log("saveEdition DUPLICATES")):(b.showDuplicatedNamesError=!1,0!=b.id?(console.log("saveEdition SCOPE ID NOT 0"),g()):(console.log("saveEdition SCOPE ID 0"),h()),i(),void c.stopPropagation()):void console.log("saveEdition IS NOT VALID")},b.$on("CREATE_EDITABLE_FIELDS_CLICKED",l),b.$on("CANCEL_EDITABLE_FIELDS",m),b.$watchCollection("expectedExpenses",function(){k()}),b.$watchCollection("expectedIncomes",function(){k()}),k()}]),angular.module("yoprojectAngularApp").controller("ExpectedSituationCtrl",["$scope","$location","$http","$rootScope","server","calculatorSaveDataService","loginService",function(a,b,c,d,e,f,g){function h(){var a=50,b=52,c=74,d=100,e=45,f=2*e,g=window.innerHeight-b-c-a-f-d;return Math.max(5,Math.ceil(g/e)-1)}function i(){if(a.numPerPage=h(),a.paginatedFields=[],a.currentPage=1,a.totalLength=a.fields.length,a.maxSize=Math.ceil(a.fields.length/a.numPerPage),_.any(a.fields,{id:0})){var b=_.find(a.fields,{id:0}),c=a.fields.indexOf(b)+1;a.currentPage=Math.ceil(c/a.numPerPage)}a.$watch("currentPage + numPerPage",function(){a.begin=(a.currentPage-1)*a.numPerPage,a.end=a.begin+a.numPerPage,a.paginatedFields=a.fields.slice(a.begin,a.end)})}function j(){nv.addGraph(function(){return q=nv.models.discreteBarChart().x(function(a){return a.name}).y(function(a){return a.value}).staggerLabels(!0).showValues(!0).duration(500),k(),nv.utils.windowResize(function(){l()}),q})}function k(){var b=[{key:"incomes",values:a.incomeFields},{key:"expenses",values:a.expensesFields}];d3.select("#chart svg").datum(b).call(q)}function l(){_.isUndefined(q)||(k(),d3.select(".nv-x.nv-axis").selectAll("text").style("text-anchor","end").attr("transform",function(){return"translate (-10, 0) rotate(-45)"}))}function m(){var b=0;return a.expensesFields.forEach(function(a){b+=a.value}),b}function n(){_.any(a.expensesFields,{id:0})?a.expensesFields.splice(a.expensesFields.length-1,1):a.incomeFields.splice(a.incomeFields.length-1,1),a.disabled=!1}function o(){a.disabled=!0}function p(){a.disabled=!1}a.incomeFields=f.getExpectedIncome(),a.expensesFields=f.getExpectedExpenses(),a.fields=a.incomeFields.concat(a.expensesFields),a.disabled=!1,a.loginStatus=g.loginStatus;var q,r=0,s=0;a.showTotalMonthlyBenefits=function(){return a.incomeFields.length>0},a.showTotalMonthlyExpenses=function(){return a.expensesFields.length>0},a.calculateExpectedExpenses=function(){return s=m(),l(),s},a.calculateExpectedBenefits=function(){var b=0;return a.incomeFields.forEach(function(a){b+=a.value}),r=b-m(),l(),r},a.addIncomeField=function(){a.disabled=!0,a.showNewIncomeItem=!0,a.incomeFields.push({name:"INCOME"+(a.incomeFields.length+1),value:"",type:"income",id:0,deleted:!1}),d.$broadcast("CREATE_EDITABLE_FIELDS_CLICKED")},a.addExpensesField=function(){a.disabled=!0,a.showNewExpensesItem=!0,a.expensesFields.push({name:"EXPENSE"+(a.expensesFields.length+1),value:"",type:"expense",id:0,deleted:!1}),d.$broadcast("CREATE_EDITABLE_FIELDS_CLICKED")},a.removeIncomeItem=function(a){null!=a.id&&(a.deleted=!0)},a.removeExpensesItem=function(a){null!=a.id&&(a.deleted=!0)},a.filterDeleted=function(a){return a.deleted===!1},i(),a.$watchCollection("incomeFields",function(b){a.fields=b.concat(a.expensesFields),i()}),a.$watchCollection("expensesFields",function(b){a.fields=a.incomeFields.concat(b),i()}),a.$watch("currentPage",function(b){b>a.maxSize&&a.currentPage--}),a.$on("CANCEL_CREATE_EDITABLE_FIELD",n),a.$on("CREATE_EDITABLE_FIELDS_CLICKED",o),a.$on("CANCEL_EDITABLE_FIELDS",p);var q=j(),t=d3.select("#chart svg"),u=t.selectAll("g.nv-wrap.nv-axis"),v=u.select("g").selectAll("g");v.attr("transform",function(a,b,c){return"translate (-15, 60) rotate(-90 0,0)"})}]),angular.module("yoprojectAngularApp").controller("InstantEntryCtrl",["$scope","calculatorSaveDataService",function(a,b){a.entry={date:new Date},a.showSavedInstant=!1,a.categories=b.getExpectedExpenses().concat(b.getExpectedIncome()),a.saveInstantData=function(c){c&&(b.saveInstantData(a.incomeFieldValue,a.entry.selectedCategory,a.entry.date),a.showSavedInstant=!0)}}]),angular.module("yoprojectAngularApp").controller("LeftPanelCtrl",["$scope","$location","loginService",function(a,b,c){a.goMain=function(){b.path("/")},a.goYearlyOverview=function(){b.path("/yearlyOverview")},a.goDailySituation=function(){b.path("/dailySituation")},a.goInstantEntry=function(){b.path("/instantEntry")},a.goAccount=function(){b.path("/account")},a.logout=function(){c.logout(),c.setIsLogged(!1),b.path("/login")}}]),angular.module("yoprojectAngularApp").controller("LoginCtrl",["$scope","$location","$http","loginService","userService",function(a,b,c,d,e){function f(){a.signup.isErrorCreatingUser=!1,a.signup.isUserCreated=!1,a.signup.isErrorWithPasswordMatching=!1,a.signup.user="",a.signup.pass="",a.signup.repeatedPass=""}function g(b){a.loginStatus.isError=!0}function h(){}function i(){d.loginStatus.isLogged&&b.path("/")}a.signup={},a.signup.buttonMessage="Sign up",a.signup.errorMessage="",a.signup.isErrorCreatingUser=!1,a.loginStatus={isError:!1},a.isDisabled=function(){return void 0===a.username||void 0===a.password||""===a.username||""===a.password},a.login=function(){d.login(a.username,a.password).then(h,g)},a.register=function(b){a.checkPasswordMatch(),b&&!a.signup.isErrorWithPasswordMatching&&c.post("/api/account/register",{Email:a.signup.user,Password:a.signup.pass}).success(function(b,c,d,e){a.signup.isUserCreated=!0,a.signup.isShowForm=!1,a.signup.buttonMessage="Sign up"}).error(function(b,c,d,e){a.signup.isErrorCreatingUser=!0;var f=_.isNull(b)||_.isUndefined(b.Message)?"There's been an error":b.Message;a.signup.errorMessage=f})},a.toggleCreateUserForm=function(){f(),a.signup.isShowForm=!a.signup.isShowForm,a.signup.buttonMessage=a.signup.isShowForm?"Hide":"Sign up"},a.checkPasswordMatch=function(){return a.signup.pass!==a.signup.repeatedPass?void(a.signup.isErrorWithPasswordMatching=!0):void(a.signup.isErrorWithPasswordMatching=!1)},a.hideMessage=function(){a.signup.isErrorCreatingUser=!1},i(),a.$watch(function(){return d.loginStatus.isLogged},function(a,c){a&&b.path("/")})}]),angular.module("yoprojectAngularApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("yoprojectAngularApp").controller("RealDailySituationCtrl",["$scope","calculatorSaveDataService","calculatorSaveDailyRealSituationService",function(a,b,c){function d(){var b=0;return a.dailyExpensesFields.forEach(function(a){b+=a.value}),b}a.dailyIncomeFields=b.getIncomeFieldsWithoutValue(),a.dailyExpensesFields=b.getExpensesFieldsWithoutValue(),a.dailyFields=a.dailyIncomeFields.concat(a.dailyExpensesFields),a.daily={date:new Date},a.calculateDailyExpenses=function(){var a=d();return a},a.calculateDailyBenefits=function(){var b=0;a.dailyIncomeFields.forEach(function(a){b+=a.value});var c=b-d();return c},a.saveDailySituation=function(){c.saveData(a.dailyFields,a.daily.date),a.realDailySituationForm.$setPristine(),a.dailyIncomeFields=b.getIncomeFieldsWithoutValue(),a.dailyExpensesFields=b.getExpensesFieldsWithoutValue(),a.daily={date:new Date}},a.$watchCollection("dailyIncomeFields",function(b){a.dailyFields=b.concat(a.dailyExpensesFields)}),a.$watchCollection("dailyExpensesFields",function(b){a.dailyFields=a.dailyIncomeFields.concat(b)})}]),angular.module("yoprojectAngularApp").controller("UserCtrl",["$scope","$modal","$timeout","userService",function(a,b,c,d){a.panel=d.getUser(),a.password=null,a.showSaved=!1,a.modalInstance=void 0,a.arePasswordsEquals=!0,a.passwordsEqualsMessage=null,a.data={oldPassword:null,newPassword:null,repeatedNewPassword:null},("0001-01-01T00:00:00"===a.panel.birthday||null===a.panel.birthday||void 0===a.panel.birthday)&&(a.panel.birthday=""),a.updateUser=function(b){if(b){_.isNull(a.password)||(a.panel.newPassword=a.password);var e={id:a.panel.id,username:a.panel.username,email:a.panel.email,country:a.panel.country,birthday:a.panel.birthday,newPassword:a.panel.newPassword,self:a.panel.self};d.updateUser(e).then(function(){a.showSaved=!0,c(function(){a.showSaved=!1},3e3)})}},a.updatePassword=function(){a.open("sm")},a.open=function(c){a.modalInstance=b.open({scope:a,animation:!0,templateUrl:"../views/changePassword.html",size:c})},a.cancel=function(){a.modalInstance.dismiss("cancel")},a.confirmUpdatePassword=function(b,c){if(c){if(a.arePasswordsEquals=a.data.newPassword===a.data.repeatedNewPassword,!a.arePasswordsEquals)return void(a.passwordsEqualsMessage="Passwords must be equals");a.passwordsEqualsMessage=null,d.resetPassword(a.data.oldPassword,a.data.newPassword),a.modalInstance.close()}},a.$watch("panel.birthday",function(){("0001-01-01T00:00:00"===a.panel.birthday||null===a.panel.birthday||void 0===a.panel.birthday)&&(a.panel.birthday="")})}]),angular.module("yoprojectAngularApp").controller("YearlyOverviewCtrl",["$scope","$location","$q","calculatorSaveDataService","yearlyOverviewService",function(a,b,c,d,e){function f(a,b,c,d){return a[b.month]||(a[b.month]={},a[b.month].month=b.month,a[b.month].income=[],a[b.month].expenses=[],a[b.month].totalExpenses=0,a[b.month].benefits=0,a[b.month].totalIncomes=0),_.includes(c,b.name)?(a[b.month].income.push({name:b.name,value:b.value}),a[b.month].totalIncomes+=b.value):(a[b.month].expenses.push({name:b.name,value:b.value}),a[b.month].totalExpenses+=b.value),a[b.month].benefits=a[b.month].totalIncomes-a[b.month].totalExpenses,a[b.month].totalIncomes}function g(a,b,c,d){_.includes(a,c.name)?(_.find(b[c.month].income,{name:c.name}).value+=c.value,b[c.month].totalIncomes+=_.filter(b[c.month].income,{name:c.name})[0].value):(_.filter(b[c.month].expenses,{name:c.name})[0].value+=c.value,b[c.month].totalExpenses+=c.value),b[c.month].benefits=b[c.month].totalIncomes-b[c.month].totalExpenses}function h(){var b=c.defer(),d=b.promise;return e.getYearlyBalance().then(function(c){var d=_.pluck(c.incomes,"name"),e=_.pluck(c.expenses,"name");c.incomes.forEach(function(a){l[a.month]&&void 0!==_.find(l[a.month].income,{name:a.name})?g(d,l,a,e):f(l,a,d,e)}),c.expenses.forEach(function(a){l[a.month]&&void 0!==_.find(l[a.month].expenses,{name:a.name})?g(d,l,a,e):f(l,a,d,e)}),a.overviews=Object.keys(l).map(function(a){return l[a]}),b.resolve()}),d}function i(){_.isUndefined(a.overviews)||a.overviews.forEach(function(a){var b;nv.addGraph(function(){b=nv.models.discreteBarChart().x(function(a){return a.name}).y(function(a){return a.value}).staggerLabels(!0).showValues(!0).duration(500);var c=[{key:"incomes",values:a.income},{key:"expenses",values:a.expenses}];return d3.select("#chart"+a.month+" svg").datum(c).call(b),d3.select(".nv-x.nv-axis").selectAll("text").style("text-anchor","end").attr("transform",function(){return"translate(-10, 0) rotate(-45)"}),nv.utils.windowResize(function(){d3.select(".nv-x.nv-axis").selectAll("text").style("text-anchor","end").attr("transform",function(){return"translate(-10, 0) rotate(-45)"})}),b}),k.push(b)})}function j(){h().then(function(){i()})}a.incomeExpected=d.getExpectedIncome(),a.expensesExpected=d.getExpectedExpenses(),a.benefitsExpected=d.getTotalBenefitsExpected(),a.totalExpensesExpected=d.getTotalExpensesExpected(),a.currentYear=(new Date).getFullYear();var k=[],l={};a.getExpectedIncome=function(b){var c;return a.incomeExpected.forEach(function(a){a.name==b&&(c=a.value)}),c},a.getExpectedExpense=function(b){var c;return a.expensesExpected.forEach(function(a){a.name==b&&(c=a.value)}),c},a.getExpectedMessage=function(a,b){return"undefined"==typeof a||"undefined"==typeof b||isNaN(a)?void 0:b>=a?"Good":"Failed expectatives :("},a.getExpectedMessageIncomeBenefits=function(a,b){return"undefined"==typeof a||"undefined"==typeof b||isNaN(a)?void 0:a>=b?"Good":"Failed expectatives :("},a.getMonthName=function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"];return b[a-1]},j()}]),angular.module("yoprojectAngularApp").directive("balanceEntry",function(){return{restrict:"E",replace:!0,scope:{id:"=",date:"=",name:"=",value:"=",format:"="},templateUrl:"../views/balanceEntry.html",controller:"BalanceEntryDirectiveCtrl",link:function(a,b){var c=b;a.removeThisElement=function(){c.remove()}}}}),angular.module("yoprojectAngularApp").directive("expectedEntry",function(){return{restrict:"E",replace:!0,scope:{id:"=",type:"=",name:"=",value:"="},templateUrl:"../views/expectedEntry.html",controller:"ExpectedEntryDirectiveCtrl"}}),angular.module("yoprojectAngularApp").directive("validatePassword",function(){return{require:"ngModel",link:function(a,b,c,d){d.$validators.validatePassword=function(a){function b(a){return null!=a.match(/[A-Z]/)}function c(a){return null!=a.match(/[a-z]/)}function e(a){return null!=a.match(/[0-9]/)}function f(a){return null!=a.match(/[-!$%^&@*()_+|~=`{}\[\]:";'<>?,.\/]/)}function g(a){return a.length>=6&&a.length<255}if(_.isNull(a)||_.isUndefined(a))return a;var b=b(a),c=c(a),e=e(a),g=g(a),f=f(a);return d.$setValidity("containsUpperLetter",b),d.$setValidity("containsLowerLetter",c),d.$setValidity("containsdigit",e),d.$setValidity("hascorrectlength",g),d.$setValidity("containsSymbol",f),a}}}}),angular.module("yoprojectAngularApp").service("loginService",["$location","$http","$rootScope","$q","userService",function(a,b,c,d,e){function f(){i.setIsLogged(!1)}function g(b){return function(){b.resolve(),i.setIsLogged(!0),a.path("/"),e.loadUser()}}function h(a){return function(){a.reject()}}var i=this;i.loginStatus={isLogged:!1},i.setIsLogged=function(b){i.loginStatus.isLogged=b,i.loginStatus.isLogged||a.path("/login")},i.login=function(a,c){var e=d.defer();return b.post("api/account/login",{Email:a,Password:c}).success(g(e)).error(h(e)),e.promise},i.logout=function(){b({url:"api/account/logout",method:"POST"}),a.path("/login")},c.$on("USER_UNAUTHENTICATED",f)}]),angular.module("yoprojectAngularApp").service("calculatorSaveDailyRealSituationService",["$http","$q","server",function(a,b,c){function d(b,d){var e={Name:b.name,Value:b.value,ExpectedIncome:{ExpectedIncomeId:b.id},Date:d};a.post(c+"api/Incomes",e).success(function(a){}).error(function(a){console.log("Error saving daily incomes")})}function e(b,d){var e={Name:b.name,Value:b.value,ExpectedExpense:{ExpectedExpenseId:b.id},Date:d};a.post(c+"api/Expenses",e).success(function(a){}).error(function(a){console.log("Error saving daily expenses")})}var f=this;f.saveData=function(a,b){a.forEach(function(a){null!=a.value&&0!=a.value&&("income"==a.type?d(a,b):e(a,b))})}}]),angular.module("yoprojectAngularApp").service("calculatorSaveDataService",["$http","$q","server",function(a,b,c){function d(b,c,d){var e={value:b,expectedIncome:{ExpectedIncomeId:c.id},date:d};a.post("api/Incomes",e).success(function(a){}).error(function(a){console.log("Error: ",a)})}function e(b,c,d){var e={value:b,expectedExpense:{ExpectedExpenseId:c.id},date:d};a.post("api/Expenses",e).success(function(a){}).error(function(a){console.log("Error saving instant expenses")})}var f,g=[],h=[],i=this;i.loadExpectedSituation=function(){var d=b.defer(),e=b.defer();return a.get(c+"api/ExpectedIncomes").success(function(a){a.forEach(function(a){f={name:a.Name,value:a.Value,id:a.ExpectedIncomeId,type:"income",deleted:a.Deleted},g.push(f),d.resolve(f)})}).error(function(a){d.reject(),console.log("Error getting expected incomes")}),a.get(c+"api/ExpectedExpenses").success(function(a){a.forEach(function(a){f={name:a.Name,value:a.Value,id:a.ExpectedExpenseId,type:"expense",deleted:a.Deleted},e.resolve(f),h.push(f)})}).error(function(a){console.log("Error getting expected expenses"),e.reject()}),b.all([e,e])},i.deleteExpectedExpenses=function(b){a.put(c+"api/ExpectedExpenses/"+b.expectedExpenseId,b).success(function(a){}).error(function(a){console.log("Error: ",a)});var d=_.findIndex(h,"name",b.name);d>-1&&h.splice(d,1)},i.deleteExpectedIncomes=function(b){a.put(c+"api/ExpectedIncomes/"+b.expectedIncomeId,b).success(function(a){}).error(function(a){console.log("Error deleting expected incomes")});var d=_.findIndex(g,"name",b.name);d>-1&&g.splice(d,1)},i.isExpense=function(a){return _.any(i.getExpensesFieldsWithoutValue(),{name:a})},i.isIncome=function(a){return _.any(i.getIncomeFieldsWithoutValue(),{name:a})},i.getExpectedIncome=function(){return g},i.getExpectedExpenses=function(){return h},i.getExpectedExpenseId=function(a){return _.find(h,{name:a}).id},i.getExpectedIncomeId=function(a){return _.find(g,{name:a}).id},i.getExpensesFieldsWithoutValue=function(){var a=[];return i.getExpectedExpenses().forEach(function(b){a.push({name:b.name,value:0,id:b.id,type:"expense",deleted:b.deleted})}),a},i.getIncomeFieldsWithoutValue=function(){var a=[];return i.getExpectedIncome().forEach(function(b){a.push({name:b.name,value:0,id:b.id,type:"income",deleted:b.deleted})}),a},i.getTotalBenefitsExpected=function(){return _.sum(g,function(a){return a.value})-_.sum(h,function(a){return a.value})},i.getTotalExpensesExpected=function(){return _.sum(h,function(a){return a.value})},i.updateExpectedExpenses=function(b,d){a.put(c+"api/ExpectedExpenses/"+b,d).success(function(a){}).error(function(a){console.log("Error updating expected expenses")})},i.updateExpectedIncomes=function(b,d){a.put(c+"api/ExpectedIncomes/"+b,d).success(function(a){}).error(function(a){console.log("Error updating expected incomes")})},i.saveExpectedIncome=function(b){
a.post("api/ExpectedIncomes",b).success(function(a){_.last(g).id=a.ExpectedIncomeId,_.last(g).type="income",_.last(g).deleted=a.Deleted,_.last(g).name=a.Name,_.last(g).value=a.Value}).error(function(a){console.log("Error: ",a)})},i.saveExpectedExpense=function(b){a.post("api/ExpectedExpenses",b).success(function(a){_.last(h).id=a.ExpectedExpenseId,_.last(h).type="expense",_.last(h).deleted=a.Deleted,_.last(h).name=a.Name,_.last(h).value=a.Value}).error(function(a){console.log("Error saving expected expenses")})},i.saveInstantData=function(a,b,c){return _.any(g,b)?void d(a,b,c):void(_.any(h,b)&&e(a,b,c))}}]),angular.module("yoprojectAngularApp").constant("server","/"),angular.module("yoprojectAngularApp").service("userService",["$http","$q","$rootScope","$location","server",function(a,b,c,d,e){var f=this,g={username:null,email:null,country:null,birthday:null},h=!0;f.loadUser=function(){var e=b.defer();return a.get("api/account/user").success(function(a){return console.log("USER loaded"),_.isUndefined(a.Id)?void e.reject():(g.id=a.Id,g.username=a.UserName,g.email=a.Email,g.country=a.Country,g.birthday=a.Birthday,h=!1,void e.resolve(g))}).error(function(){"/reset-by-token"!==d.path()&&c.$broadcast("USER_UNAUTHENTICATED"),e.reject()}),e.promise},f.loadUserIfNeeded=function(){if(h)return f.loadUser();var a=b.defer();return a.resolve(),a.promise},f.updateUser=function(c){var d=b.defer();return a.put("/api/account/updateuser/"+c.id,c).success(function(){d.resolve({})}),d.promise},f.resetPassword=function(c,d){var e=b.defer(),f={OldPassword:c,NewPassword:d};return a.post("/api/account/updatepassword",f).success(function(){e.resolve({})}).error(function(){e.reject()}),e.promise},f.resetForgottenPasswordRequest=function(c){var d=b.defer();return a.post("/api/account/reset-forgotten-password-request",{email:c}).success(function(){d.resolve({})}).error(function(){d.reject()}),d.promise},f.resetForgottenPassword=function(c,d,e){var f=b.defer();return a.post("/api/account/reset-forgotten-password",{email:c,password:d,token:e}).success(function(){f.resolve({})}).error(function(){f.reject()}),f.promise},f.getUser=function(){return g}}]),angular.module("yoprojectAngularApp").service("yearlyOverviewService",["$http","$q","server",function(a,b,c){function d(b){g=[],a.get("api/Expenses").success(function(a){a.forEach(function(a){var b={name:a.ExpectedExpense.Name,value:a.Value,month:new Date(Date.parse(a.Date)).getUTCMonth()+1,day:new Date(Date.parse(a.Date)).getUTCDate(),year:new Date(Date.parse(a.Date)).getFullYear(),date:new Date(Date.parse(a.Date)),week:f.getWeek(new Date(Date.parse(a.Date))),type:"expense",id:a.ExpenseId,deleted:a.ExpectedExpense.Deleted};g.push(b)}),b.resolve(g)}).error(function(a){b.reject(a)})}function e(b){h=[],a.get("api/Incomes").success(function(a){a.forEach(function(a){var b={name:a.ExpectedIncome.Name,value:a.Value,month:new Date(Date.parse(a.Date)).getUTCMonth()+1,day:new Date(Date.parse(a.Date)).getUTCDate(),year:new Date(Date.parse(a.Date)).getFullYear(),date:new Date(Date.parse(a.Date)),week:f.getWeek(new Date(Date.parse(a.Date))),type:"income",id:a.IncomeId,deleted:a.ExpectedIncome.Deleted};h.push(b)}),b.resolve(h)}).error(function(a){b.reject(a)})}var f=this,g=[],h=[];f.getWeek=function(a){var b=864e5,c=new Date(a.getFullYear(),0,1);return Math.ceil(((a-c)/b+c.getDay()+1)/7)},f.getYearlyBalance=function(){var a=b.defer(),c=a.promise,f=b.defer(),g=f.promise;e(a),d(f);var h=b.defer();return b.all([c,g]).then(function(a){var b={incomes:a[0],expenses:a[1]};h.resolve(b)}),h.promise},f.deleteExpenses=function(b){a["delete"]("api/Expenses/"+b).success(function(a){}).error(function(a){console.log("Error deleting expenses")})},f.deleteIncomes=function(b){a["delete"]("api/Incomes/"+b).success(function(a){}).error(function(a){console.log("Error deleting incomes")})},f.updateExpenses=function(b,c){a.put("api/Expenses/"+b,c).success(function(a){}).error(function(a){console.log("Error updating expenses")})},f.updateIncomes=function(b,c){a.put("api/Incomes/"+b,c).success(function(a){}).error(function(a){console.log("Error updating incomes")})}}]);